<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" href="http://uvu.edu/favicon.ico" />
  <title>Grader Aide</title>

  <!-- material icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- jquery -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

  <!-- axios -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>

  <!-- custom js -->
  <script type="text/javascript" src="common-functions.js"></script>

  <!-- materialize -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

  <!-- vue -->
  <script src="https://unpkg.com/vue@2.5.13/dist/vue.js"></script>
  <script src="https://unpkg.com/http-vue-loader@1.3.4/src/httpVueLoader.js"></script>

  <!-- custom styles -->
  <link rel="stylesheet" href="assets/styles/styles.css">
</head>

<body>
  <div id="app">
    <edit-modal :modal-id="modalId" :rules="rules"></edit-modal>

    <div class="assignment-container main-background">
      <div class="container">
        <div class="row">
          <div class="col s12">
            <div class="card">
              <div class="card-content">

                <!-- INLINE assignment name editing -->
                <template v-if="!assignmentEditable">
                  <span class="card-title main-card" @click="assignmentEditable = true">{{ assignmentName }}
                </template>
                <template v-else>
                  <input class="card-title main-card" v-model="assignmentName" v-on:keyup.enter="updateAssignmentName()" v-on:blur="updateAssignmentName()">
                </template>

                <!-- INLINE total points editing -->
                <template v-if="!totalPtsEditable">
                  <h5 @click="totalPtsEditable = true">Total Points Possible: {{totalPts}}</h5>
                </template>
                <template v-else>
                  <h5 style="display:inline;">Total Points Possible:
                    <input style="width:100px; font-size:24px;" type="number" v-model="totalPts" v-on:keyup.enter="updateTotalPts()" v-on:blur="updateTotalPts()"
                    />
                  </h5>
                </template>
                <div class="divider"></div>
                <div class="row">
                  <!-- accordian card -->
                  <div class="col s8">
                    <ul class="collapsible" data-collapsible="accordion">
                      <!-- rules -->
                      <li>
                        <div class="collapsible-header active">
                          <i class="material-icons">playlist_add_check</i>Rules
                        </div>
                        <div class="collapsible-body">
                          <form>
                            <p v-for="rule of rules">
                              <input type="checkbox" @click="handleRuleOrCommentStatusChange(rule)" :id="rule.desc" v-model="rule.checked" />
                              <label :for="rule.desc">{{rule.pts | handlePositive}} {{rule.desc}}</label>
                            </p>
                          </form>
                        </div>
                      </li>
                      <!-- comments -->
                      <li>
                        <div class="collapsible-header">
                          <i class="material-icons">comment</i>Comments</div>
                        <div class="collapsible-body">
                          <p v-for="comment of comments">
                            <input type="checkbox" @click="handleRuleOrCommentStatusChange(comment)" :id="comment.desc" v-model="comment.checked" />
                            <label :for="comment.desc">{{comment.desc}}</label>
                          </p>
                        </div>
                      </li>

                      <button class="btn waves-effect waves-light z-depth-0 green" type="submit" name="action" @click="selectAll()">All</button>
                      <a class="btn waves-effect waves-light z-depth-0 yellow black-text right modal-trigger" :href="`#${modalId}`">
                        <i class="material-icons">mode_edit</i>
                      </a>
                      <button class="btn waves-effect waves-light z-depth-0 red right" type="submit" @click="resetChecked()" name="action">Reset</button>
                    </ul>

                  </div>

                  <!-- summary card -->
                  <div id="summary-card" class="col s4">
                    <div class="card">
                      <div id="summary-card" class="card-content">
                        <ul class="collection with-header">
                          <li class="collection-header">
                            <h5>Rules</h5>
                          </li>
                          <li class="collection-item" v-for="rule of selectedRules">{{rule.pts | handlePositive}} {{rule.desc}}</li>
                        </ul>
                        <ul class="collection with-header">
                          <li class="collection-header">
                            <h5>Comments</h5>
                          </li>
                          <li class="collection-item" v-for="comment of selectedComments">{{comment.pts}} {{comment.desc}}</li>
                        </ul>
                      </div>
                      <button class="btn waves-effect waves-light z-depth-0 green" style="visibility:hidden"></button>
                      <!-- THIS IS NECESSARY TO CREATE SPACING FOR THE BUTTON BELOW IN THE DIV -->

                      <button class="btn tooltipped waves-effect waves-light z-depth-0 green right" type="submit" name="action" @click="copyToClip()"
                        data-tooltip="Copy to clipboard">
                        <i class="material-icons">content_copy</i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<!-- initialize modal for for display -->
<script>
  $(document).ready(function () {
    // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
  });
</script>

<script>
  const app = new Vue({
    el: '#app',
    data: {
      // persistent state
      assignmentID: '3b706b34-8bc4-4b30-aea7-9a3f9018f8fc',
      assignmentName: 'Lab 1',
      totalPts: 100,
      assignmentEditable: false,
      totalPtsEditable: false,
      rules: [
        { id: 'ce5e019c-44e7-4c75-8309-496599bd7c64', pts: -1, desc: 'Test test test', checked: false },
        { id: '1678d1d2-fdec-41c7-8982-3d7e42eb4c99', pts: -5, desc: 'Hello World', checked: false },
        { id: 'bd2ab547-10c9-45e0-8169-c8e7355a5e4e', pts: 1, desc: 'Extra credit', checked: false }
      ],
      comments: [
        { id: '4163d23c-6bff-43ea-90b4-751012e52582', desc: 'This is comment one', checked: false },
        { id: '006bfd49-04de-408c-8817-b5733777fb23', desc: 'lorem ipsum', checked: false },
        { id: '241a2814-ec4f-448c-a8d8-6ebb7d4b35a2', desc: 'A bird in the hand is worth two in the bush', checked: false }
      ],
      // gui state
      allSelected: false,
      modalId: 'edit-modal'
    },
    filters: {
      handlePositive: function (value) {
        if (value > 0) {
          return '+' + value;
        }
        else return value;
      }
    },
    methods: {
      handleRuleOrCommentStatusChange(item) {
        item.checked = !item.checked;
      },
      createAssignment() {
        axios.post(`/assignments/`, {
          id: this.assignmentID,
          name: this.assignmentName,
          totalPts: this.totalPts,
          nextRuleID: this.nextRuleID,
          rules: this.rules,
          comments: this.comments
        })
          .then(function (response) {
            //console.log(response);
          })
          .catch(function (error) {
            console.log(error);
          });
      },
      updateAssignment() {
        axios.put(`/assignments/${this.assignmentID}`, {
          id: this.assignmentID,
          name: this.assignmentName,
          totalPts: this.totalPts,
          nextRuleID: this.nextRuleID,
          rules: this.rules,
          comments: this.comments
        })
          .then(function (response) {
            //console.log(response);
          })
          .catch(function (error) {
            console.log(error);
          });
      },
      selectAll() {
        if (!this.allSelected) {
          for (let rule of this.rules) {
            rule.checked = true;
          }
          for (let comment of this.comments) {
            comment.checked = true;
          }
        }
        else {
          for (let rule of this.rules) {
            rule.checked = false;
          }
          for (let comment of this.comments) {
            comment.checked = false;
          }
        }
        this.allSelected = !this.allSelected;
      },
      resetChecked() {

        for (let rule of this.rules) {
          rule.checked = false;
        }
        for (let comment of this.comments) {
          comment.checked = false;
        }

        this.allSelected = false;
      },
      copyToClip() {
        if (document.selection) {
          var range = document.body.createTextRange();
          range.moveToElementText(document.getElementById("summary-card"));
          range.select().createTextRange();
          document.execCommand("copy");
          console.log("doc text copied");

        } else if (window.getSelection) {
          var range = document.createRange();
          range.selectNode(document.getElementById("summary-card"));
          window.getSelection().addRange(range);
          console.log(range);
          document.execCommand("copy");
          console.log("window text copied");

        }
      },
      updateAssignmentName() {
        console.log(event);
        this.assignmentEditable = false;
        //TODO update assignment name in database
      },
      updateTotalPts() {
        console.log(event);
        this.totalPtsEditable = false;
        //TODO update totalPts in database
      }


    },
    computed: {
      selectedRules() {
        return this.rules.filter(rule => rule.checked)
      },
      selectedComments() {
        return this.comments.filter(comment => comment.checked)

      }
    },
    components: {
      'hello-world': httpVueLoader('./components/HelloWorld.vue'),
      EditModal: httpVueLoader('./components/EditModal.vue')
    },
    created: function () {
    }
  });



  // At a minimum, complete these

  // save(storing the json) via axios
  // recover / restore deleted rule in memory stack
  // edit rule
  // edit name
  // edit totalPts
  // list of comments(no points up or down)
  // edit list of comments(no points up or down)
  // delete list of comments / recovering
  // create a new assignment
  // You can add other features at will.You can improve the look.The design is up to you.For example, for editing an assignment, you could do in place or modal or a hybrid.



</script>

</html>